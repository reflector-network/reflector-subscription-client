!function(A,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@stellar/stellar-sdk")):"function"==typeof define&&define.amd?define(["@stellar/stellar-sdk"],t):"object"==typeof exports?exports.subscriptions=t(require("@stellar/stellar-sdk")):A.subscriptions=t(A["@stellar/stellar-sdk"])}(this,(A=>(()=>{"use strict";var t={346:t=>{t.exports=A}},e={};function r(A){var n=e[A];if(void 0!==n)return n.exports;var i=e[A]={exports:{}};return t[A](i,i.exports,r),i.exports}r.d=(A,t)=>{for(var e in t)r.o(t,e)&&!r.o(A,e)&&Object.defineProperty(A,e,{enumerable:!0,get:t[e]})},r.o=(A,t)=>Object.prototype.hasOwnProperty.call(A,t);var n={};r.d(n,{default:()=>y});var i=r(346);const a={0:"Contract has been already initialized",1:"This account is not the owner of the subscription",2:"Subscription was not found",3:"Account has not been initialized yet",4:"Insufficient deposit amount",5:"Invalid heartbeat value",6:"Invalid threshold value",7:"Encoded webhook value is too long",8:"Subscription has been suspended"};class o{constructor(A,t){this.id=A,this.status=0===t.status?"active":"suspended",this.owner=t.owner,this.base=t.base,this.quote=t.quote,this.threshold=t.threshold,this.heartbeat=t.heartbeat,this.balance=t.balance,this.updated=new Date(Number(t.updated))}id;status;owner;base;quote;threshold;heartbeat;webhook="[encrypted]";balance;updated}class s extends i.contract.Client{options;constructor(A){super(new i.contract.Spec(["AAAAAQAAAAAAAAAAAAAAC1RpY2tlckFzc2V0AAAAAAIAAAAAAAAABWFzc2V0AAAAAAAAEAAAAAAAAAAGc291cmNlAAAAAAAQ","AAAAAQAAAAAAAAAAAAAADFN1YnNjcmlwdGlvbgAAAAkAAAAAAAAAB2JhbGFuY2UAAAAABgAAAAAAAAAEYmFzZQAAB9AAAAALVGlja2VyQXNzZXQAAAAAAAAAAAloZWFydGJlYXQAAAAAAAAEAAAAAAAAAAVvd25lcgAAAAAAABMAAAAAAAAABXF1b3RlAAAAAAAH0AAAAAtUaWNrZXJBc3NldAAAAAAAAAAABnN0YXR1cwAAAAAH0AAAABJTdWJzY3JpcHRpb25TdGF0dXMAAAAAAAAAAAAJdGhyZXNob2xkAAAAAAAABAAAAAAAAAAHdXBkYXRlZAAAAAAGAAAAAAAAAAd3ZWJob29rAAAAAA4=","AAAABAAAAAAAAAAAAAAABUVycm9yAAAAAAAACQAAAAAAAAASQWxyZWFkeUluaXRpYWxpemVkAAAAAAAAAAAAAAAAAAxVbmF1dGhvcml6ZWQAAAABAAAAAAAAABRTdWJzY3JpcHRpb25Ob3RGb3VuZAAAAAIAAAAAAAAADk5vdEluaXRpYWxpemVkAAAAAAADAAAAAAAAAA1JbnZhbGlkQW1vdW50AAAAAAAABAAAAAAAAAAQSW52YWxpZEhlYXJ0YmVhdAAAAAUAAAAAAAAAEEludmFsaWRUaHJlc2hvbGQAAAAGAAAAAAAAAA5XZWJob29rVG9vTG9uZwAAAAAABwAAAAAAAAAeSW52YWxpZFN1YnNjcmlwdGlvblN0YXR1c0Vycm9yAAAAAAAI","AAAAAQAAAAAAAAAAAAAAFlN1YnNjcmlwdGlvbkluaXRQYXJhbXMAAAAAAAYAAAAAAAAABGJhc2UAAAfQAAAAC1RpY2tlckFzc2V0AAAAAAAAAAAJaGVhcnRiZWF0AAAAAAAABAAAAAAAAAAFb3duZXIAAAAAAAATAAAAAAAAAAVxdW90ZQAAAAAAB9AAAAALVGlja2VyQXNzZXQAAAAAAAAAAAl0aHJlc2hvbGQAAAAAAAAEAAAAAAAAAAd3ZWJob29rAAAAAA4=","AAAAAwAAAAAAAAAAAAAAElN1YnNjcmlwdGlvblN0YXR1cwAAAAAAAgAAAAAAAAAGQWN0aXZlAAAAAAAAAAAAAAAAAAlTdXNwZW5kZWQAAAAAAAAB","AAAAAAAAAAAAAAATY3JlYXRlX3N1YnNjcmlwdGlvbgAAAAACAAAAAAAAABBuZXdfc3Vic2NyaXB0aW9uAAAH0AAAABZTdWJzY3JpcHRpb25Jbml0UGFyYW1zAAAAAAAAAAAABmFtb3VudAAAAAAABgAAAAEAAAPtAAAAAgAAAAYAAAfQAAAADFN1YnNjcmlwdGlvbg==","AAAAAAAAAAAAAAAHZGVwb3NpdAAAAAADAAAAAAAAAARmcm9tAAAAEwAAAAAAAAAPc3Vic2NyaXB0aW9uX2lkAAAAAAYAAAAAAAAABmFtb3VudAAAAAAABgAAAAA=","AAAAAAAAAAAAAAAGY2FuY2VsAAAAAAABAAAAAAAAAA9zdWJzY3JpcHRpb25faWQAAAAABgAAAAA=","AAAAAAAAAAAAAAAQZ2V0X3N1YnNjcmlwdGlvbgAAAAEAAAAAAAAAD3N1YnNjcmlwdGlvbl9pZAAAAAAGAAAAAQAAB9AAAAAMU3Vic2NyaXB0aW9u","AAAAAAAAAAAAAAARZ2V0X3JldGVudGlvbl9mZWUAAAAAAAABAAAAAAAAAA9zdWJzY3JpcHRpb25faWQAAAAABgAAAAEAAAAG","AAAAAAAAAAAAAAAHdmVyc2lvbgAAAAAAAAAAAQAAAAQ=","AAAAAAAAAAAAAAADZmVlAAAAAAAAAAABAAAABg==","AAAAAAAAAAAAAAAFdG9rZW4AAAAAAAAAAAAAAQAAABM="]),A),this.options=A}fromJSON={create_subscription:this.txFromJSON,deposit:this.txFromJSON,cancel:this.txFromJSON,get_subscription:this.txFromJSON,get_retention_fee:this.txFromJSON,version:this.txFromJSON,last_id:this.txFromJSON,fee:this.txFromJSON,token:this.txFromJSON}}const c={validateRequired(A,t){if(!A)throw new TypeError(`Parameter "${t}" is required`);return A},validateNumber(A,t){if(this.validateRequired(A,t),"number"!=typeof A)throw new TypeError(`Parameter "${t}" - number expected`);return A},validateString(A,t){if(this.validateRequired(A,t),"string"!=typeof A||!A.length)throw new TypeError(`Parameter "${t}" - string expected`);return A},validateBigint(A,t){if(this.validateRequired(A,t),"bigint"!=typeof A)try{A=BigInt(A)}catch(A){throw new Error(`Invalid "${t}" value`)}if(A<=0n)throw new Error(`Invalid "${t}" value`);return A},validateAccount(A,t){if(this.validateString(A,t),!i.StrKey.isValidEd25519PublicKey(A))throw new TypeError(`Invalid "${t}" account address`);return A},validateBalance(A,t){return this.validateBigint(A,t)},validateOracleSymbol(A,t){return this.validateRequired(A,t),this.validateString(A.source,t+".source"),this.validateString(A.asset,t+".asset"),A},validateThreshold(A){if(this.validateNumber(A,"threshold"),A<1)throw new Error("Subscription threshold cannot be less than 1‰");if(A>1e4)throw new Error("Subscription threshold cannot be greater than 10,000‰");return Math.floor(A)},validateHeartbeat(A){if(this.validateNumber(A,"heartbeat"),A<5)throw new Error("Subscription heartbeat cannot be less than 5 minutes");if(A>240)throw new Error("Subscription heartbeat cannot be greater than 240 minutes");return Math.floor(A)},validateWebhook(A){if(this.validateString(A,"webhook"),!A.startsWith("https://")&&!A.startsWith("http://"))throw new TypeError("Only HTTP and HTTPS webhook URLs are supported");if(A.length>2e3)throw new TypeError("Webhook URL is too long");return A}},{subtle:l}=crypto,d=(new Uint8Array([1,0,1]),new TextEncoder);async function u(A,t){const e=crypto.getRandomValues(new Uint8Array(32)),r=crypto.getRandomValues(new Uint8Array(12)),n=await l.encrypt({name:"AES-GCM",iv:r},await(a=e,l.importKey("raw",h(a),{name:"AES-GCM"},!0,["encrypt","decrypt"])),h(t)),i=new Uint8Array(44);var a;i.set(e,0),i.set(r,32);const o=await l.encrypt({name:"RSA-OAEP"},A,i),s=new Uint8Array(256+n.byteLength);return s.set(new Uint8Array(o),0),s.set(new Uint8Array(n),256),s}function h(A){return"string"==typeof A?d.encode(A):A instanceof ArrayBuffer?new Uint8Array(A):A}const b="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAyGCtE3dNoq53CkG9D3JtJig5f15hQsjL8fogRZQmZJqbGax8uJEVYCfJmvC5Qe9uVFf9rD1TJLmB/qonYOMTph929opC400fWXGvOSPtTNTvAUTSzKqfMPWN4KjyAvMZkm0dWac9ZQer4fI1M4TUbc4xFMbvM4mL0JlZw6Bo04iVpwxznHwNAT3or1Akh2qrYHkZdhPhewQ9sfmfiTt4/mrGidsGKzvCFjZ1UElBK8M7VL9oM/6BCiCEHDFrLepiS9A7gbMn247UJub/6hgjNvkV203rDgMhORwkaljY+dAC9DWLX06D3lVYEVzeEK8uFcIDDyQ8wb/q6imLqR5bcwIDAQAB";let p;async function w(A){return p||(p=await function(A){let t="pkcs8",e="decrypt";return(A=h(A)).length<500&&(t="spki",e="encrypt"),l.importKey(t,A,{name:"RSA-OAEP",hash:"SHA-256"},!0,[e])}(function(A){const t=atob(A),e=new Uint8Array(t.length);for(let A=0;A<t.length;A++)e[A]=t.charCodeAt(A);return e}(b))),u(p,A)}function v(A){if(A.simulation.error){const t=/HostError: Error\(Contract, #(\d+)\)/.exec(A.simulation.error);throw t?new Error("Contract execution error: "+a[t[1]]):A.simulation.error}}class y{constructor(A){const t={publicKey:A.publicKey,signTransaction:A.signTransaction,rpcUrl:A.rpcUrl,networkPassphrase:A.networkPassphrase||i.Networks.PUBLIC,contractId:A.contractId||"CBNGTWIVRCD4FOJ24FGAKI6I5SDAXI7A4GWKSQS7E6UYSR4E4OHRI2JX"};this.client=new s(t)}client;async getSubscription(A){A=c.validateBigint(A,"subscriptionId");const t=await this.client.get_subscription({subscription_id:A});return v(t),new o(A,t.result)}async createSubscription(A){let{owner:t=this.client.options.publicKey,base:e,quote:r,threshold:n,heartbeat:i,webhook:a,initialBalance:s}=A;c.validateAccount(t,"owner"),c.validateOracleSymbol(e,"base"),c.validateOracleSymbol(r,"quote"),n=c.validateThreshold(n),i=c.validateHeartbeat(i),c.validateWebhook(a),s=c.validateBalance(s,"initialBalance");const l=await w(a),d=await this.client.create_subscription({new_subscription:{owner:t,base:e,quote:r,heartbeat:i,threshold:n,webhook:l},amount:s});v(d);const u=await d.signAndSend();return new o(u.result[0],u.result[1])}async deposit(A,t,e){A=c.validateBigint(A,"subscriptionId"),t=c.validateBigint(t,"amountToDeposit"),c.validateAccount(e,"from");const r=await this.client.deposit({subscription_id:A,amount:t,from:e});v(r),await r.signAndSend()}async cancel(A){A=c.validateBigint(A,"subscriptionId");const t=await this.client.cancel({subscription_id:A});v(t),await t.signAndSend()}async getRetentionFee(A){A=c.validateBigint(A,"subscriptionId");const t=await this.client.get_retention_fee({subscription_id:A});return v(t),t.result}async getToken(){const A=await this.client.token();return v(A),A.result}async getVersion(){const A=await this.client.version();return v(A),A.result}async getFee(){const A=await this.client.fee();return v(A),A.result}async getLastId(){const A=await this.client.last_id();return v(A),A.result}}return n.default})()));
//# sourceMappingURL=subscriptions.js.map